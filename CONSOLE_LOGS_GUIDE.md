# 控制台日志说明

## 日志输出示例

### 1. 代理池初始化

当您设置代理池时，会看到：

```
======================================================================
🌐 代理池配置
   代理数量: 2
   1. http://127.0.0.1:61079
   2. ***@na.9dc1b25972c51e1b.abcproxy.vip:4950
   轮换策略: 每 30 个邮箱切换
======================================================================
```

**说明**：
- 显示代理池中的所有代理
- 带密码的代理会自动隐藏密码部分（显示为 `***`）
- 显示轮换策略（默认每30个邮箱切换）

### 2. 首次代理切换（初始化）

```
======================================================================
🔄 代理切换
   当前代理: http://127.0.0.1:61079
   代理索引: 1/2
   已检测数: 0 个邮箱
======================================================================
🔑 正在获取新的 session token...
✅ 新 session 已建立
   状态码: 200
   Cookies: ['machineid', 'authtoken', '__cf_bm']
   Token: Bearer%20eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ...
======================================================================
```

**说明**：
- 显示当前使用的代理
- 显示代理在池中的位置（1/2 表示第1个，共2个）
- 显示已检测的邮箱数量
- 显示获取到的 session token 和 cookies

### 3. 邮箱检测过程

```
[1] 检测 test1@example.com (代理 1/2) -> 🟢 邮箱未注册
[2] 检测 test2@example.com (代理 1/2) -> 🔴 邮箱已注册
[3] 检测 test3@example.com (代理 1/2) -> 🟢 邮箱未注册
...
[28] 检测 test28@example.com (代理 1/2) -> 🟢 邮箱未注册
[29] 检测 test29@example.com (代理 1/2) -> 🔴 邮箱已注册
[30] 检测 test30@example.com (代理 1/2) -> 🟢 邮箱未注册
```

**说明**：
- `[数字]`：当前检测的序号
- `(代理 1/2)`：使用的代理索引
- `🟢`：未注册
- `🔴`：已注册
- `❌`：检测失败
- `⚠️`：警告（如 Cloudflare 拦截）

### 4. 达到切换阈值

```
📊 已检测 30 个邮箱，达到切换阈值，准备切换代理...

======================================================================
🔄 代理切换
   当前代理: ***@na.9dc1b25972c51e1b.abcproxy.vip:4950
   代理索引: 2/2
   已检测数: 30 个邮箱
======================================================================
🔑 正在获取新的 session token...
✅ 新 session 已建立
   状态码: 200
   Cookies: ['machineid', 'authtoken', '__cf_bm']
   Token: Bearer%20eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ...
======================================================================
```

**说明**：
- 提示已达到30个邮箱的切换阈值
- 自动切换到下一个代理
- 重新获取新的 session token
- 重置检测计数器

### 5. 继续检测（使用新代理）

```
[1] 检测 test31@example.com (代理 2/2) -> 🟢 邮箱未注册
[2] 检测 test32@example.com (代理 2/2) -> 🔴 邮箱已注册
[3] 检测 test33@example.com (代理 2/2) -> 🟢 邮箱未注册
...
```

**说明**：
- 注意代理索引变为 `2/2`
- 检测序号重新从 1 开始计数
- 使用新的 session token

### 6. 错误情况

#### Cloudflare 拦截
```
[15] 检测 test15@example.com (代理 1/2) -> ⚠️  Cloudflare 保护阻止访问，请稍后重试或使用代理
```

#### 代理连接失败
```
[20] 检测 test20@example.com (代理 2/2) -> ❌ 代理连接失败，请检查代理设置
```

#### 请求超时
```
[25] 检测 test25@example.com (代理 1/2) -> ❌ 请求超时，请检查网络连接或代理设置
```

## 完整测试示例

运行测试脚本：
```bash
cd /Users/linzaizai/Desktop/check_register
source venv/bin/activate
python backend/test_with_logs.py
```

### 预期输出

```
======================================================================
🚀 Stir.com 邮箱检测系统 - 代理池测试
======================================================================

======================================================================
🌐 代理池配置
   代理数量: 2
   1. http://127.0.0.1:61079
   2. ***@na.9dc1b25972c51e1b.abcproxy.vip:4950
   轮换策略: 每 30 个邮箱切换
======================================================================

======================================================================
🔄 代理切换
   当前代理: http://127.0.0.1:61079
   代理索引: 1/2
   已检测数: 0 个邮箱
======================================================================
🔑 正在获取新的 session token...
✅ 新 session 已建立
   状态码: 200
   Cookies: ['machineid', 'authtoken', '__cf_bm']
   Token: Bearer%20eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
======================================================================

📋 开始批量检测 35 个邮箱
⏱️  预计在第 30 个邮箱后切换代理

[1] 检测 test1@example.com (代理 1/2) -> 🔴 邮箱已注册
[2] 检测 test2@example.com (代理 1/2) -> 🔴 邮箱已注册
[3] 检测 test3@example.com (代理 1/2) -> 🔴 邮箱已注册
[4] 检测 salustianomarty458@gmail.com (代理 1/2) -> 🔴 邮箱已注册
[5] 检测 test5@example.com (代理 1/2) -> 🔴 邮箱已注册
...
[28] 检测 test28@example.com (代理 1/2) -> 🔴 邮箱已注册
[29] 检测 test29@example.com (代理 1/2) -> 🔴 邮箱已注册
[30] 检测 test30@example.com (代理 1/2) -> 🔴 邮箱已注册

📊 已检测 30 个邮箱，达到切换阈值，准备切换代理...

======================================================================
🔄 代理切换
   当前代理: ***@na.9dc1b25972c51e1b.abcproxy.vip:4950
   代理索引: 2/2
   已检测数: 30 个邮箱
======================================================================
🔑 正在获取新的 session token...
✅ 新 session 已建立
   状态码: 200
   Cookies: ['machineid', 'authtoken', '__cf_bm']
   Token: Bearer%20eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
======================================================================

[1] 检测 test31@example.com (代理 2/2) -> 🔴 邮箱已注册
[2] 检测 test32@example.com (代理 2/2) -> 🔴 邮箱已注册
[3] 检测 test33@example.com (代理 2/2) -> 🔴 邮箱已注册
[4] 检测 test34@example.com (代理 2/2) -> 🔴 邮箱已注册
[5] 检测 test35@example.com (代理 2/2) -> 🔴 邮箱已注册

======================================================================
📊 检测完成 - 统计结果
======================================================================
⏱️  总耗时: 87.45 秒
📧 总计: 35 个邮箱
🔴 已注册: 35 个
🟢 未注册: 0 个
❌ 失败: 0 个
⚡ 平均速度: 2.50 秒/个
======================================================================
```

## 日志符号说明

| 符号 | 含义 |
|------|------|
| 🌐 | 代理池配置 |
| 🔄 | 代理切换 |
| 🔑 | 获取 session token |
| ✅ | 操作成功 |
| 📊 | 统计信息 |
| 📋 | 任务列表 |
| ⏱️ | 时间相关 |
| 📧 | 邮箱相关 |
| 🔴 | 已注册 |
| 🟢 | 未注册 |
| ❌ | 错误/失败 |
| ⚠️ | 警告 |
| ⚡ | 速度/性能 |

## 观察要点

### 1. 代理是否正确切换
- 检查第30个邮箱后是否出现"代理切换"日志
- 检查代理索引是否从 `1/2` 变为 `2/2`
- 检查是否获取了新的 token

### 2. Token 是否更新
- 每次切换代理后，Token 应该不同
- 检查 `authtoken` cookie 是否存在

### 3. 检测结果是否正常
- 如果大量显示"未注册"，可能是被限制了
- 如果出现 403 错误，说明 Cloudflare 拦截
- 如果出现代理错误，检查代理是否可用

### 4. 性能指标
- 平均速度应在 2-3 秒/个
- 如果太慢，可能是代理速度慢
- 如果太快，可能需要增加延迟

## 故障排查

### 问题1：没有看到代理切换日志
**可能原因**：
- 检测数量少于30个
- 代理池只有1个代理
- 代理池未正确设置

**解决方案**：
- 确认至少检测31个邮箱
- 确认代理池有多个代理
- 检查代理池配置日志

### 问题2：切换代理后仍然失败
**可能原因**：
- 新代理不可用
- 新代理也被封禁
- Token 未正确更新

**解决方案**：
- 检查新代理是否可用
- 尝试更换代理池
- 检查 token 获取日志

### 问题3：所有结果都是"未注册"
**可能原因**：
- 代理被限制
- Token 失效
- API 返回异常

**解决方案**：
- 更换代理池
- 增加请求延迟
- 检查 API 响应内容

## 调试技巧

1. **查看完整日志**：运行测试脚本，观察完整的输出
2. **检查代理切换时机**：确认在第30个邮箱后切换
3. **对比 Token**：切换前后的 Token 应该不同
4. **监控成功率**：如果成功率低，及时调整策略
5. **记录问题模式**：记录哪些代理容易出问题

## 生产环境建议

1. **日志级别**：生产环境可以减少日志输出
2. **日志文件**：将日志输出到文件而不是控制台
3. **监控告警**：设置失败率告警
4. **定期轮换**：定期更换代理池
5. **性能优化**：根据日志优化延迟和切换策略

